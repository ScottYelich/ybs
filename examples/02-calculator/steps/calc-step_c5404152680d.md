# Step 2: Create Calculator Module

**System**: calculator
**Step ID**: calc-step_c5404152680d
**Implements**: calculator-spec.md § 2.1 (Core Operations)
**Prerequisites**: Step 1 (Initialize Project Structure)
**Duration**: 10-15 minutes

---

## Purpose

Implement the core calculator module with four basic arithmetic operations: add, subtract, multiply, and divide. This module contains the mathematical logic with proper error handling.

---

## Inputs

- `BUILD_CONFIG.json` - Build configuration
- `src/calculator.{py|js}` - Placeholder file from Step 1

**Required fields**:
- `language` - Determines implementation language
- `file_ext` - File extension

---

## Outputs

- `src/calculator.{py|js}` - Complete calculator module with all operations

---

## Instructions

### 1. Read Configuration

```bash
# Read language from BUILD_CONFIG.json
LANGUAGE=$(python -c "import json; print(json.load(open('BUILD_CONFIG.json'))['language'])")
echo "Language: $LANGUAGE"
```

---

### 2. Implement Calculator Module

Choose implementation based on language:

#### Python Implementation

**File**: `src/calculator.py`

```python
# Implements: calculator-spec.md § 2.1 (Core Operations)
"""Calculator core operations module.

This module provides four basic arithmetic operations:
- add: Addition of two numbers
- subtract: Subtraction of two numbers
- multiply: Multiplication of two numbers
- divide: Division with zero-check
"""


def add(a: float, b: float) -> float:
    """Add two numbers.

    Implements: calculator-spec.md § 2.1 F1 (Addition)

    Args:
        a: First number
        b: Second number

    Returns:
        Sum of a and b

    Examples:
        >>> add(5, 3)
        8.0
        >>> add(-5, 3)
        -2.0
        >>> add(1.5, 2.5)
        4.0
    """
    return a + b


def subtract(a: float, b: float) -> float:
    """Subtract b from a.

    Implements: calculator-spec.md § 2.1 F2 (Subtraction)

    Args:
        a: First number (minuend)
        b: Second number (subtrahend)

    Returns:
        Difference of a - b

    Examples:
        >>> subtract(10, 4)
        6.0
        >>> subtract(-5, 3)
        -8.0
        >>> subtract(10.5, 3.2)
        7.3
    """
    return a - b


def multiply(a: float, b: float) -> float:
    """Multiply two numbers.

    Implements: calculator-spec.md § 2.1 F3 (Multiplication)

    Args:
        a: First number
        b: Second number

    Returns:
        Product of a * b

    Examples:
        >>> multiply(6, 7)
        42.0
        >>> multiply(-5, 3)
        -15.0
        >>> multiply(2.5, 4)
        10.0
    """
    return a * b


def divide(a: float, b: float) -> float:
    """Divide a by b.

    Implements: calculator-spec.md § 2.1 F4 (Division)

    Args:
        a: Numerator
        b: Denominator

    Returns:
        Quotient of a / b

    Raises:
        ValueError: If b is zero (division by zero)

    Examples:
        >>> divide(15, 3)
        5.0
        >>> divide(-10, 2)
        -5.0
        >>> divide(7, 2)
        3.5
        >>> divide(10, 0)
        Traceback (most recent call last):
            ...
        ValueError: Division by zero
    """
    if b == 0:
        raise ValueError("Division by zero")
    return a / b
```

---

#### JavaScript Implementation

**File**: `src/calculator.js`

```javascript
// Implements: calculator-spec.md § 2.1 (Core Operations)
/**
 * Calculator core operations module.
 *
 * This module provides four basic arithmetic operations:
 * - add: Addition of two numbers
 * - subtract: Subtraction of two numbers
 * - multiply: Multiplication of two numbers
 * - divide: Division with zero-check
 */

/**
 * Add two numbers.
 *
 * Implements: calculator-spec.md § 2.1 F1 (Addition)
 *
 * @param {number} a - First number
 * @param {number} b - Second number
 * @returns {number} Sum of a and b
 *
 * @example
 * add(5, 3)  // returns 8
 * add(-5, 3)  // returns -2
 * add(1.5, 2.5)  // returns 4.0
 */
function add(a, b) {
  return a + b;
}

/**
 * Subtract b from a.
 *
 * Implements: calculator-spec.md § 2.1 F2 (Subtraction)
 *
 * @param {number} a - First number (minuend)
 * @param {number} b - Second number (subtrahend)
 * @returns {number} Difference of a - b
 *
 * @example
 * subtract(10, 4)  // returns 6
 * subtract(-5, 3)  // returns -8
 * subtract(10.5, 3.2)  // returns 7.3
 */
function subtract(a, b) {
  return a - b;
}

/**
 * Multiply two numbers.
 *
 * Implements: calculator-spec.md § 2.1 F3 (Multiplication)
 *
 * @param {number} a - First number
 * @param {number} b - Second number
 * @returns {number} Product of a * b
 *
 * @example
 * multiply(6, 7)  // returns 42
 * multiply(-5, 3)  // returns -15
 * multiply(2.5, 4)  // returns 10.0
 */
function multiply(a, b) {
  return a * b;
}

/**
 * Divide a by b.
 *
 * Implements: calculator-spec.md § 2.1 F4 (Division)
 *
 * @param {number} a - Numerator
 * @param {number} b - Denominator
 * @returns {number} Quotient of a / b
 * @throws {Error} If b is zero (division by zero)
 *
 * @example
 * divide(15, 3)  // returns 5
 * divide(-10, 2)  // returns -5
 * divide(7, 2)  // returns 3.5
 * divide(10, 0)  // throws Error: Division by zero
 */
function divide(a, b) {
  if (b === 0) {
    throw new Error('Division by zero');
  }
  return a / b;
}

module.exports = {
  add,
  subtract,
  multiply,
  divide
};
```

---

### 3. Verify Implementation

#### Manual Testing (Python)

```python
# Start Python REPL
python3

# Import and test
>>> from src.calculator import add, subtract, multiply, divide
>>> add(5, 3)
8.0
>>> subtract(10, 4)
6.0
>>> multiply(6, 7)
42.0
>>> divide(15, 3)
5.0
>>> divide(10, 0)
Traceback (most recent call last):
  ...
ValueError: Division by zero
```

---

#### Manual Testing (JavaScript)

```bash
# Start Node REPL
node

# Import and test
> const { add, subtract, multiply, divide } = require('./src/calculator');
> add(5, 3)
8
> subtract(10, 4)
6
> multiply(6, 7)
42
> divide(15, 3)
5
> divide(10, 0)
Error: Division by zero
```

---

### 4. Quick Smoke Test

Create a temporary test file to verify basic functionality:

#### Python Smoke Test

```bash
cat > test_smoke.py << 'EOF'
from src.calculator import add, subtract, multiply, divide

print("Testing add(5, 3):", add(5, 3))
print("Testing subtract(10, 4):", subtract(10, 4))
print("Testing multiply(6, 7):", multiply(6, 7))
print("Testing divide(15, 3):", divide(15, 3))

try:
    divide(10, 0)
    print("ERROR: Division by zero should raise error")
except ValueError as e:
    print("Testing divide(10, 0):", str(e))

print("\n✅ All smoke tests passed")
EOF

python test_smoke.py
rm test_smoke.py
```

---

#### JavaScript Smoke Test

```bash
cat > test_smoke.js << 'EOF'
const { add, subtract, multiply, divide } = require('./src/calculator');

console.log("Testing add(5, 3):", add(5, 3));
console.log("Testing subtract(10, 4):", subtract(10, 4));
console.log("Testing multiply(6, 7):", multiply(6, 7));
console.log("Testing divide(15, 3):", divide(15, 3));

try {
    divide(10, 0);
    console.log("ERROR: Division by zero should throw error");
} catch (e) {
    console.log("Testing divide(10, 0):", e.message);
}

console.log("\n✅ All smoke tests passed");
EOF

node test_smoke.js
rm test_smoke.js
```

---

### 5. Update BUILD_STATUS.md

Add Step 2 completion to the build log:

```markdown
### Step 2: Create Calculator Module
- **Started**: <ISO8601_timestamp>
- **Completed**: <ISO8601_timestamp>
- **Duration**: X minutes
- **Status**: ✅ PASS
- **Notes**: Implemented add, subtract, multiply, divide with error handling
```

Update the progress checklist:
```markdown
- [x] Step 0: Build Configuration (COMPLETE)
- [x] Step 1: Initialize Project Structure (COMPLETE)
- [x] Step 2: Create Calculator Module (COMPLETE)
- [ ] Step 3: Create Parser Module
```

---

## Verification

### Success Criteria

- ✅ Calculator module implements all four operations
- ✅ Each function has proper traceability comments
- ✅ Division by zero raises appropriate error
- ✅ Functions work with positive, negative, and decimal numbers
- ✅ All smoke tests pass
- ✅ BUILD_STATUS.md updated

### Verification Commands

```bash
# Check file exists
test -f src/calculator.py && echo "✅ Python calculator exists" || \
test -f src/calculator.js && echo "✅ JavaScript calculator exists"

# Verify traceability comments present
# Python:
grep -q "Implements: calculator-spec.md" src/calculator.py && echo "✅ Traceability present"

# JavaScript:
grep -q "Implements: calculator-spec.md" src/calculator.js && echo "✅ Traceability present"

# Count functions (should be 4)
# Python:
grep -c "^def " src/calculator.py  # Should output: 4

# JavaScript:
grep -c "^function " src/calculator.js  # Should output: 4

# Run smoke test (see section 4 above)
```

---

## Error Handling

### Common Issues

1. **Import errors**: Ensure `src/__init__.py` exists (Python) or correct module.exports (JavaScript)
2. **Type errors**: All parameters should accept numeric types
3. **Division by zero not caught**: Ensure `if b == 0` check exists

### Recovery

If step fails:
1. Restore placeholder: `git checkout src/calculator.{py|js}`
2. Re-implement following instructions
3. Verify with smoke tests

---

## Next Step

**Step 3**: Create Parser Module (calc-step_89b9e6233da5.md)

---

## Notes

- Functions are intentionally simple (1-3 lines of logic)
- Comprehensive docstrings enable auto-generated documentation
- Error handling follows language conventions (ValueError for Python, Error for JavaScript)
- Operations use float/number types to handle decimals automatically
- Unit tests for these functions will be written in Step 6

---

**Traceability**: Implements calculator-spec.md § 2.1 (Core Operations)
