# Step 000001: Define Architecture & Choose Technology Stack

**Version**: 0.3.0

## Overview

This step documents the fundamental architectural decisions for the build. The programming language and target platform(s) were collected in Step 0 via BUILD_CONFIG.json. LLM providers will be configurable later via the configuration system.

## Why This Step Matters

These choices affect:
- **Project structure**: Different languages have different conventions
- **Build tools**: Package managers, compilers, test frameworks
- **Dependencies**: Available libraries and their maturity
- **Sandboxing approach**: Platform-specific security mechanisms
- **Distribution**: How users will install and run your system
- **Development speed**: Your familiarity with the language

## Configurable Values

- `{{CONFIG:language|choice[Swift,Python,Go,Rust,TypeScript]|Programming language for the project|Swift}}` - Used throughout architecture documentation
- `{{CONFIG:platform|choice[macOS only,Linux only,macOS + Linux,All platforms]|Target platform(s) for deployment|macOS only}}` - Used in architecture decisions

## Step Objectives

1. Read language and platform choices from BUILD_CONFIG.json
2. Document all choices in BUILD_STATUS.md
3. Create ARCHITECTURE.md file with decisions and rationale
4. Verify documentation
5. Document completion

**Note**: LLM provider selection will be handled later via configuration system (JSON config file), not as an architecture choice.

## Instructions

### 1. Read Configuration Values

Read the language and platform from BUILD_CONFIG.json:

```bash
LANGUAGE=$(jq -r '.values.language' BUILD_CONFIG.json)
PLATFORM=$(jq -r '.values.platform' BUILD_CONFIG.json)
echo "Language: $LANGUAGE"
echo "Platform: $PLATFORM"
```

Store these values for use in documentation.

### 2. Create ARCHITECTURE.md

Create `builds/SYSTEMNAME/ARCHITECTURE.md` documenting the choices:

```markdown
# Architecture Decisions: SYSTEMNAME

**Version**: 0.1.0
**Decided**: [current timestamp]

## Technology Stack

### Programming Language
**Choice**: LANGUAGE

**Rationale**: [based on user's choice, explain why this makes sense]

**Implications**:
- Project structure: [language-specific structure]
- Build tool: [e.g., Swift Package Manager, pip, cargo, npm, go modules]
- Package manager: [tool name]
- Testing framework: [tool name]

### Target Platform(s)
**Choice**: PLATFORMS

**Rationale**: [based on user's choice]

**Implications**:
- Sandboxing approach: [platform-specific notes]
- Distribution: [how users will install]
- CI/CD: [what to test on]

### LLM Provider Support
**Strategy**: Configurable via JSON configuration file

**Rationale**: LLM providers should be pluggable and user-configurable, not hardcoded architecture decisions. The configuration system (implemented in a later step) will allow users to choose Ollama, OpenAI, Anthropic, or any OpenAI-compatible provider.

**Implications**:
- API abstraction: Provider protocol/interface needed
- Configuration: JSON config with provider, model, endpoint, API key fields
- Dependencies: HTTP client for REST APIs, JSON parsing
- Default: Will default to Ollama (local, no API key) for development

## Implementation Notes

### Language-Specific Details

#### LANGUAGE
- **Build command**: [e.g., swift build, cargo build, npm run build]
- **Test command**: [e.g., swift test, pytest, cargo test, npm test]
- **Run command**: [e.g., swift run, python -m, cargo run, npm start]
- **Package file**: [e.g., Package.swift, pyproject.toml, Cargo.toml, package.json]

### Platform-Specific Details

#### PLATFORMS
- **Sandboxing**: [approach for each platform]
- **File paths**: [considerations for path handling]
- **Shell execution**: [platform-specific notes]

### LLM Integration (Configurable)

- **HTTP client**: [what library to use]
- **API abstraction**: Provider protocol for pluggable backends
- **Configuration**: JSON file with provider, model, endpoint, API key
- **Supported providers**: Ollama, OpenAI, Anthropic, any OpenAI-compatible API
- **Default**: Ollama at http://localhost:11434 (local, no key needed)

## Next Steps

Step 000002 will set up the LANGUAGE project structure with appropriate build tools and initial files.

---

**Reference Documentation**:
- Language chosen: Based on user preference
- Original spec reference: `../../specs/technical/ybs-spec.md` (was Swift-specific, adapt as needed)
- Architectural decisions: `../../specs/architecture/ybs-decisions.md` (reference but adapt)
```

Replace `SYSTEMNAME`, `LANGUAGE`, `PLATFORMS` with actual values from BUILD_CONFIG.json.

### 3. Update BUILD_STATUS.md

Add architecture section to `builds/SYSTEMNAME/BUILD_STATUS.md`:

```markdown
## Architecture Decisions
- **Language**: LANGUAGE
- **Platform(s)**: PLATFORMS
- **LLM Providers**: Configurable (via config system)
- **Decided**: [timestamp]
- **Details**: See ARCHITECTURE.md
```

Update the status section:
```markdown
**Current Step**: step_000001
**Step Version**: 0.1.0
**Status**: completed
**Last Updated**: [timestamp]

## Current Step Details
- **Title**: Define Architecture & Choose Technology Stack
- **Status**: completed
- **Issues**: none

## Next Action
Ready to proceed to step_000002 (Set up LANGUAGE project structure).
```

### 4. Verify Choices

Run verification to confirm everything is documented:

**Verification Commands**:
```bash
# Verify ARCHITECTURE.md exists
test -f builds/SYSTEMNAME/ARCHITECTURE.md && echo "✓ ARCHITECTURE.md created"

# Show architecture decisions
echo "=== Architecture Decisions ==="
cat builds/SYSTEMNAME/ARCHITECTURE.md

# Verify BUILD_STATUS.md updated
echo "=== BUILD_STATUS.md Architecture Section ==="
grep -A 5 "Architecture Decisions" builds/SYSTEMNAME/BUILD_STATUS.md
```

### 5. Document Completion

Create `builds/SYSTEMNAME/docs/build-history/step_000001-DONE.txt`:

```
STEP 000001: Define Architecture & Choose Technology Stack
STARTED: [timestamp]
COMPLETED: [timestamp]
DURATION: [duration]

OBJECTIVES:
- Read language and platform choices from BUILD_CONFIG.json
- Document all choices in BUILD_STATUS.md
- Create ARCHITECTURE.md with decisions and rationale
- Verify documentation

ACTIONS TAKEN:
- Read language choice from BUILD_CONFIG.json: LANGUAGE
- Read platform choice from BUILD_CONFIG.json: PLATFORMS
- Documented that LLM providers will be configurable
- Created ARCHITECTURE.md documenting all decisions
- Updated BUILD_STATUS.md with architecture section
- Verified all documentation created

VERIFICATION RESULTS:
✓ Language read from config: LANGUAGE
✓ Platform read from config: PLATFORMS
✓ LLM provider strategy documented (configurable)
✓ ARCHITECTURE.md created with complete documentation
✓ BUILD_STATUS.md updated with architecture decisions
✓ All choices documented and verified

VERIFICATION ATTEMPTS: 1

ISSUES ENCOUNTERED:
None

FILES CREATED:
- builds/SYSTEMNAME/ARCHITECTURE.md

FILES MODIFIED:
- builds/SYSTEMNAME/BUILD_STATUS.md

NEXT STEP: step_000002 (Set up LANGUAGE project structure)

ARCHITECTURE LOCKED: Yes

TIMING SUMMARY:
- Start: [timestamp]
- End: [timestamp]
- Duration: [duration]
```

Replace placeholders with actual values.

## Verification Checklist

Before marking this step complete, verify:

- [ ] Language read from BUILD_CONFIG.json
- [ ] Platform read from BUILD_CONFIG.json
- [ ] LLM provider strategy documented (configurable)
- [ ] All choices documented in ARCHITECTURE.md
- [ ] BUILD_STATUS.md updated with architecture section
- [ ] step_000001-DONE.txt created
- [ ] All files contain actual values (no placeholders)
- [ ] Timing recorded (start, end, duration)

## Success Criteria

This step is successful when:
1. Language and platform read from BUILD_CONFIG.json
2. LLM provider strategy documented as configurable
3. ARCHITECTURE.md exists with complete documentation
4. BUILD_STATUS.md contains architecture decisions
5. Documentation file exists in build-history/
6. User knows what's being built and why

## Important Notes

- **These choices are not easily reversible**: Changing language later means starting over
- **No wrong answers**: Each choice has trade-offs; pick what fits your skills and goals
- **LLM providers are configurable**: No need to choose now - config system handles this
- **Platform support**: Can be expanded, but architecture should consider it from the start

---

## Version History

### 0.3.0 (2026-01-17)
- **BREAKING**: Converted to use CONFIG markers for language and platform
- Added Configurable Values section with {{CONFIG:...}} syntax
- Step now reads from BUILD_CONFIG.json instead of asking user directly
- Updated all instructions to read from config
- Updated DONE.txt template to reflect config-based approach
- Added timing tracking (start, end, duration)

### 0.2.0 (2026-01-16)
- Removed LLM provider selection (now configurable via config system)
- Simplified to language + platform choices only
- LLM providers will be handled in configuration step

### 0.1.0 (2026-01-16)
- Initial version
- Architecture and technology stack selection
- Supports 5 languages, multiple platforms

---

**Step completed?** Proceed to `step_000002.md`
